=========================
ボールの動き等の設計
=========================

:著者: kondog

ボールの状態
============

ボールはこのソフト上で
下記の状態遷移表に従う。

.. table:: 状態遷移表

    =========== =================== ===========
    状態        意味                次状態  
    =========== =================== ===========
    初期状態    動作直後の状態      左から右
    左から右    手渡し              待機状態
    待機状態    待ち合わせ中        右から左
    右から左    ボール投げ上げ      左から右
    =========== =================== ===========

.. note::

    | 待機状態で一定フレーム待った後、
    | 右から左へ状態移行する。
    | これによってボールは常に一定間隔を保持する。

ボールの動作
============

初速度vy0,横向速度vxを直値で与えて
右手左手の幅lに合わせて落ちるようにする。

.. note::

    | ホントはvy0に合わせてvxは
    | 動的に決定するようにしたいけどできなかったので直値で。。。
    | 計算式は一度求めたが上手くいかなかった。
    | 本ドキュメントのソースにてコメントアウト中。

.. ボールの投げ上げ～着地までの動きは下記を満たす(はず)。
.. 
.. .. math:: 
.. 
..     l = vx * t
.. 
..     t = sum^{n=\frac{vy0}{g}}_{n=0}vy0-ng
.. 
.. .. table:: 変数定義
.. 
..     ======= =========================
..     変数名  意味
..     ======= =========================
..     l       右手左手間の距離
..     vx      ボールの横向きの速度
..     t       ボールの滞空時間
..     vy0     ボールの縦向きの初速度
..     g       重力加速度
..     ======= =========================
.. 
.. ここで、lは定数なので1番目の式をvxの関数に変更し、
.. 重力加速度をg=1とすると
.. 
.. .. math:: 
.. 
..     vx = \frac{l}{t}
.. 
..     t = sum^{n=vy0}_{n=0}vy0-n
.. 
.. これを解いて
.. 
.. .. math::
.. 
..     vx = \frac{2*l}{vy0*(vy0-1)}

vy0は3種類、lは2種類用意する。

手の幅について
--------------

右手のみ動作する。
右手の右側、右手の左側の2パターン。

ボールの高さについて
--------------------

| 3段階(high,middle,low)がサイトスワップに矛盾しないよう選択される。
| 現段階ではフォローするのはシャワーパターンの簡単なもののみ。
| 51
| 7131
| 913131

.. note::

    TODO:
        サイトスワップ的に矛盾しないよう自動で計算したい。
        あとシャワーパターンだけじゃなく両手でガンガン投げる
        ようにしたい。

ボールの間隔
============

| ボールとボールの間隔を
| 手から離れた後のフレーム数で管理する。
| ボールAが右手から射出された後、
| ボールBは一定フレーム数分待ってから
| 射出される。

